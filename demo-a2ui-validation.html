<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A2UI Protocol Validation Demo - DYN-224</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 40px;
            max-width: 1200px;
            margin: 0 auto;
            background: #0a0a0a;
            color: #e0e0e0;
        }
        h1 {
            color: #60a5fa;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        .subtitle {
            color: #9ca3af;
            margin-bottom: 40px;
            font-size: 1.1em;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .test-card {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
        }
        .test-card h3 {
            color: #60a5fa;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        .test-description {
            color: #9ca3af;
            margin-bottom: 15px;
            font-size: 0.9em;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.85em;
            margin-bottom: 15px;
        }
        .status.pass {
            background: #10b981;
            color: white;
        }
        .status.fail {
            background: #ef4444;
            color: white;
        }
        .code {
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            overflow-x: auto;
            margin: 10px 0;
            color: #a3a3a3;
        }
        .error-list {
            background: #fee2e2;
            border: 1px solid #fecaca;
            border-radius: 4px;
            padding: 12px;
            margin: 10px 0;
        }
        .error-item {
            color: #b91c1c;
            font-size: 0.9em;
            margin: 5px 0;
        }
        .error-type {
            background: #dc2626;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.8em;
            margin-right: 8px;
        }
        .summary {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .stat {
            text-align: center;
        }
        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #60a5fa;
        }
        .stat-label {
            color: #9ca3af;
            font-size: 0.9em;
        }
        .doc-link {
            background: #1e40af;
            color: white;
            padding: 12px 24px;
            border-radius: 6px;
            text-decoration: none;
            display: inline-block;
            margin-top: 20px;
            font-weight: 600;
        }
        .doc-link:hover {
            background: #1e3a8a;
        }
    </style>
</head>
<body>
    <h1>A2UI Protocol Validation Demo</h1>
    <p class="subtitle">Testing A2UI component validation and protocol compliance (DYN-224)</p>

    <div class="summary">
        <h2 style="color: #60a5fa; margin-bottom: 15px;">Test Results Summary</h2>
        <div class="stats-grid">
            <div class="stat">
                <div class="stat-value" id="total-tests">0</div>
                <div class="stat-label">Total Tests</div>
            </div>
            <div class="stat">
                <div class="stat-value" style="color: #10b981;" id="passed-tests">0</div>
                <div class="stat-label">Passed</div>
            </div>
            <div class="stat">
                <div class="stat-value" style="color: #ef4444;" id="failed-tests">0</div>
                <div class="stat-label">Failed</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="coverage">0%</div>
                <div class="stat-label">Success Rate</div>
            </div>
        </div>
    </div>

    <div id="test-results" class="test-grid"></div>

    <div style="text-align: center; margin-top: 40px;">
        <a href="./frontend/docs/A2UI_PROTOCOL.md" class="doc-link">View A2UI Protocol Documentation</a>
    </div>

    <script>
        // Mock catalog for validation
        const registeredTypes = [
            'a2ui.StatCard', 'a2ui.Section', 'a2ui.HeadlineCard', 'a2ui.Grid',
            'a2ui.Columns', 'a2ui.TLDR', 'a2ui.DataTable'
        ];

        function isComponentRegistered(type) {
            return registeredTypes.includes(type);
        }

        function isSerializable(value) {
            if (value === null) return true;
            const type = typeof value;
            if (['string', 'number', 'boolean'].includes(type)) return true;
            if (['function', 'undefined', 'symbol'].includes(type)) return false;
            if (Array.isArray(value)) return value.every(isSerializable);
            if (type === 'object') return Object.values(value).every(isSerializable);
            return false;
        }

        function validateA2UIComponent(component) {
            const errors = [];

            // Required: id
            if (!component.id || typeof component.id !== 'string') {
                errors.push({
                    type: 'MISSING_REQUIRED_FIELD',
                    message: 'Component must have a valid "id" field (string)',
                    path: 'root'
                });
            }

            // Required: type
            if (!component.type || typeof component.type !== 'string') {
                errors.push({
                    type: 'MISSING_REQUIRED_FIELD',
                    message: 'Component must have a valid "type" field (string)',
                    path: 'root'
                });
            } else {
                if (!isComponentRegistered(component.type)) {
                    errors.push({
                        type: 'UNREGISTERED_TYPE',
                        message: `Component type "${component.type}" is not registered in the catalog`,
                        path: 'root'
                    });
                }
            }

            // Required: props
            if (component.props === undefined || component.props === null) {
                errors.push({
                    type: 'MISSING_REQUIRED_FIELD',
                    message: 'Component must have a "props" field',
                    path: 'root'
                });
            } else if (typeof component.props !== 'object' || Array.isArray(component.props)) {
                errors.push({
                    type: 'INVALID_PROPS',
                    message: 'Component "props" must be an object',
                    path: 'root'
                });
            } else {
                for (const [key, value] of Object.entries(component.props)) {
                    if (!isSerializable(value)) {
                        errors.push({
                            type: 'NON_SERIALIZABLE_PROP',
                            message: `Prop "${key}" contains non-serializable value (function, undefined, or symbol)`,
                            path: `root.props.${key}`
                        });
                    }
                }
            }

            return {
                valid: errors.length === 0,
                errors
            };
        }

        // Test cases
        const testCases = [
            {
                name: 'Valid Simple Component',
                description: 'A valid StatCard with all required fields',
                component: {
                    id: 'test-1',
                    type: 'a2ui.StatCard',
                    props: { label: 'Users', value: '1234' }
                },
                expectedValid: true
            },
            {
                name: 'Missing Type Field',
                description: 'Component without type field (should fail)',
                component: {
                    id: 'test-2',
                    props: { label: 'Missing Type', value: '100' }
                },
                expectedValid: false
            },
            {
                name: 'Missing ID Field',
                description: 'Component without id field (should fail)',
                component: {
                    type: 'a2ui.StatCard',
                    props: { label: 'Missing ID', value: '100' }
                },
                expectedValid: false
            },
            {
                name: 'Non-Serializable Props',
                description: 'Component with function in props (should fail)',
                component: {
                    id: 'test-3',
                    type: 'a2ui.StatCard',
                    props: {
                        label: 'Test',
                        onClick: () => {} // Not serializable
                    }
                },
                expectedValid: false
            },
            {
                name: 'Unregistered Component Type',
                description: 'Component with unregistered type (should fail)',
                component: {
                    id: 'test-4',
                    type: 'a2ui.NonExistentComponent',
                    props: {}
                },
                expectedValid: false
            },
            {
                name: 'Null Props Allowed',
                description: 'Component with null prop values (should pass)',
                component: {
                    id: 'test-5',
                    type: 'a2ui.StatCard',
                    props: { label: 'Test', value: null }
                },
                expectedValid: true
            },
            {
                name: 'Complex Valid Component',
                description: 'Component with nested props and valid structure',
                component: {
                    id: 'test-6',
                    type: 'a2ui.DataTable',
                    props: {
                        headers: ['Name', 'Age'],
                        rows: [['John', 30], ['Jane', 25]],
                        sortable: true
                    }
                },
                expectedValid: true
            },
            {
                name: 'Invalid Props Type',
                description: 'Component with props as array instead of object',
                component: {
                    id: 'test-7',
                    type: 'a2ui.StatCard',
                    props: ['invalid']
                },
                expectedValid: false
            }
        ];

        // Run tests
        let passed = 0;
        let failed = 0;
        const resultsContainer = document.getElementById('test-results');

        testCases.forEach(testCase => {
            const result = validateA2UIComponent(testCase.component);
            const testPassed = result.valid === testCase.expectedValid;

            if (testPassed) passed++;
            else failed++;

            const card = document.createElement('div');
            card.className = 'test-card';

            const statusClass = testPassed ? 'pass' : 'fail';
            const statusText = testPassed ? '✓ PASS' : '✗ FAIL';

            let errorsHTML = '';
            if (result.errors.length > 0) {
                errorsHTML = '<div class="error-list">';
                result.errors.forEach(error => {
                    errorsHTML += `<div class="error-item"><span class="error-type">${error.type}</span>${error.message}</div>`;
                });
                errorsHTML += '</div>';
            }

            card.innerHTML = `
                <h3>${testCase.name}</h3>
                <p class="test-description">${testCase.description}</p>
                <div class="status ${statusClass}">${statusText}</div>
                <div class="code">${JSON.stringify(testCase.component, null, 2)}</div>
                ${errorsHTML}
            `;

            resultsContainer.appendChild(card);
        });

        // Update summary
        document.getElementById('total-tests').textContent = testCases.length;
        document.getElementById('passed-tests').textContent = passed;
        document.getElementById('failed-tests').textContent = failed;
        document.getElementById('coverage').textContent = Math.round((passed / testCases.length) * 100) + '%';
    </script>
</body>
</html>
